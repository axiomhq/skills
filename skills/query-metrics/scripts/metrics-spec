#!/usr/bin/env bash
# metrics-spec: Fetch the metrics query specification from Axiom
#
# Uses 'edge_url' from ~/.axiom.toml (falls back to 'url').
#
# Usage: metrics-spec <deployment>
#
# Calls OPTIONS /v1/query/_metrics to retrieve the complete metrics query
# spec with syntax, operators, and examples. Read this before composing queries.
#
# Example:
#   metrics-spec prod

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

DEPLOYMENT="${1:-}"

if [[ -z "$DEPLOYMENT" ]]; then
    echo "Usage: metrics-spec <deployment>" >&2
    exit 1
fi

source "$SCRIPT_DIR/config" "$DEPLOYMENT"

curl -s -X OPTIONS "${AXIOM_EDGE_URL}/v1/query/_metrics"
